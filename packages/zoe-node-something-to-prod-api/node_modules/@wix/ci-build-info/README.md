## @wix/ci-build-info

This package is intended to be used during builds in the CI environment by various developer tools.
It provides information on the currently running build flow, such as the vcs URL of the repo and package fingerprints.

### Example

```typescript
import { getBuildInfo, CiBuildInfo } from '@wix/ci-build-info'

const buildInfo: CiBuildInfo = getBuildInfo()
console.log(`The git url for the repo is ${buildInfo.v1.vcsUrl}`)
console.log(`Package 'my-package' fingerprint is ${buildInfo.v1.packages['my-package'].fingerprint}`)
```

### `CiBuildInfo` Schema

```typescript
type CiBuildInfo = {
  v1: {
    isFalcon?: boolean
    repoRootFullPath: string
    packages: Record<
      string,
      {
        // Artifact info is defined if the package has targets.
        // In legacy CI this is defined only if the package has a pom.xml file
        artifact?: {
          // Defined if the package has a static target
          cdnUrl?: {
            versioned: string
            unversioned: string
          }
          // Defined if the package has a docker target.
          // Not supported in legacy CI
          dockerImageName?: string
          // Defined if the package has an npm target.
          // Not supported in legacy CI
          npmPackageName?: string
        }
        // The fingerprint (source code hash) of the package.
        // In legacy CI this is either the ARTIFACT_VERSION or SRC_MD5 env var value
        fingerprint: string
        id: string
        fullPath: string
        // The intra-monorepo dependencies for this package.
        // Not supported in legacy CI.
        monorepoDependencies: {
          direct: string[]
          // All monorepo dependencies, including the transitive ones.
          all: string[]
        }
      }
    >
    falconBuildRunId: string
    flakinessDetectionBuildRun: boolean
    buildLogLink: string
    vcs: {
      // Defined if this is a PR build.
      // Not supported in legacy CI.
      pullRequest?: {
        // The original remote branch name
        fromBranch: string
        prNumber: string
      }
      repoName: string
      repoOwner: string
      url: string
      commitHash: string
      // The branch name for this build.
      // For master builds, the value will be master
      // For PR builds, the value will be the GitHub generated branch, e.g., 1234/head
      branch: string
    }
    v2: {} // Same as v1, but in legacy CI we prefer `SRC_MD5` over `ARTIFACT_VERSION` for the package fingerprint value
  }
}
```

### Release Process

`ci-build-info` changes are coupled to data changes in falcon-cli itself.\
Therefore we first need to release falcon-cli with the changes, wait until it's stable and there are no rollbacks/reverts (around a week), then we can manually bump the `ci-build-info` version in order to release it as well.
