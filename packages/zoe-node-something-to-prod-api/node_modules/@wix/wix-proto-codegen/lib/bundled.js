const path = require('path');
const shelljs = require('shelljs');

const MODULES = [
  '@wix/extensions',
];

const BUNDLED_DIR = path.join(__dirname, '..', 'proto');

const DIRS = [
  ...MODULES.map(m => path.resolve(path.dirname(require.resolve(`${m}/package.json`)), 'src', 'main', 'proto')),
  BUNDLED_DIR
];

const allProtoFiles = (mapper = file => file) => DIRS.reduce((acc, dir) => [...acc, ...shelljs.ls(path.join(dir, '/**/*.proto')).map(file => mapper(file, dir))], []);

const FILES = allProtoFiles((file, dir) => path.relative(dir, file));
const FILES_ABSOLUTE = allProtoFiles();

function resolve(target) {
  return DIRS.map(dir => path.join(dir, target)).find(file => shelljs.test('-e', file));
}

module.exports = {FILES, FILES_ABSOLUTE, DIRS, resolve};
