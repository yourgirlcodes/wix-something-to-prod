const peg = require('pegjs');
const fs = require('fs');
const path = require('path');
const _ = require('lodash');

const grammar = fs.readFileSync(path.join(__dirname, 'path-template.pegjs'), {encoding: 'utf8'});
const parser = peg.generate(grammar);

function verifyNoDuplicate(vars) {
  if (_.uniq(vars).length !== vars.length) {
    throw new SyntaxError('duplicate variable bindings found');
  }
}

function parsePathTemplate(path) {
  const vars = parser.parse(path);
  verifyNoDuplicate(vars);
  return vars;
}

module.exports = {parsePathTemplate};

