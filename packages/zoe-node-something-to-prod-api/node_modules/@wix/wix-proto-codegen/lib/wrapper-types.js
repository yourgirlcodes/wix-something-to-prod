const {Root} = require('@wix/wnp-protobufjs'),
  {join} = require('path');

const NAMESPACE = 'google.protobuf';

function loadWrapperTypesFromProto() {
  const root = new Root();
  root.loadSync(join(__dirname, '..', 'proto', 'google', 'protobuf', 'wrappers.proto'));
  return root.lookup(NAMESPACE).nestedArray.map(t => `${NAMESPACE}.${t.name}`);
}

const names = loadWrapperTypesFromProto();

const primitiveMappings = names.map(fqn => {
  const [name] = fqn.split('.').reverse();
  const primitive = name.substring(0, name.length - 5).toLowerCase();
  return [fqn, primitive];
}).reduce((acc, [key, value]) => {acc[key] = value; return acc;}, {});

function isWrapperType(type) {
  return names.includes(type);
}

module.exports = {names, primitiveMappings, isWrapperType};
