// syntax https://github.com/googleapis/googleapis/blob/master/google/api/http.proto#L225
// java https://github.com/googleapis/api-common-java/blob/master/src/main/java/com/google/api/pathtemplate/PathTemplate.java

{
    // all the variables resolved will be collected into this array and returned by the first rule
    const vars = [];
}

// though missing leading slash seems to be illegal, Java's PathTemplate permits. So shall we
template 		= "/"? segments verb? { return vars }
segments		= segment ("/" segment)*
segment			= "**" / "*" / variable / literal
field_path		= first:ident rest:("." ident:ident {return ident})* { return [first, ...rest].join('.') }
literal 		= [a-zA-Z0-9_\-\.~,:]+
variable		= "{" path:field_path ("=" segments)? "}" { vars.push(path) }
ident			= ident:[_a-zA-Z0-9\-]+ { return ident.join('') }
verb 			= ":" literal