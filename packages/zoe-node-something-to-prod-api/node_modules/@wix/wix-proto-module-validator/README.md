# wix-proto-module-validator

CLI & programmatic utility for validating proto modules.

## Validation Rules

The `wix-proto-module-validators`, validates the following:
 - `package.json` must contain flag `wnp_type` set to `proto`
 - There has to be at least one `.proto` file under `./src/main/proto` (or it's descendants)
 - There are no `.proto` files on different locations rather than under `./src/main/proto` (or it's descendants)
 - The module must not contain a `pom.xml` file (this check is not running in CI - https://ci-kb.wixanswers.com/en/article/ci-and-protobuf)
 - Code generation, ran by [wix-proto-codegen](../wix-proto-codegen/README.md) succeeds with no errors
 - All protobuf files define a `package` (no default empty package allowed).
 - Compatibility with [protoc](https://github.com/protocolbuffers/protobuf/releases/) generator. Currently using v3.11.4. (can be disabled using `--skipProtoc` - see [CLI options](#cli))  

## install
```
npm install --save-dev @wix/wix-proto-module-validator
```

## Usage

### CLI
`npx @wix/wix-proto-module-validator [options]`

parameter|mandatory|description
---|---|---
`--module` | no | relative/absolute path to npm module to be validated. If ommited, running on the current folder.
`--skipProtoc` | no | if passed, `protoc` compatibility validation will not be applied.
`--skipLint` | no | if passed, will not run [flynt](https://github.com/wix-private/flynt) 

### via package.json build step
_inside your package.json_
```json
    "scripts": {
      "test": "wix-proto-module-validator"
    },
    "devDependencies": {
      "@wix/wix-proto-module-validator": "^1.0.0"
    }
```

### programmatic
```js
const wixProtoModuleValidator = require('@wix/wix-proto-module-validator');

const opts = {
  location: 'path/to/proto-module',
  skipPomValidation: true | false // defaults to false 
}

await wixProtoModuleValidator(opts);
```
