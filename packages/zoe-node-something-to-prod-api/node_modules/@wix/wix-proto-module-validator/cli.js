#!/usr/bin/env node

const protoModuleValidator = require('./index');
const argv = require('yargs').argv;
const {isCI} = require('@wix/wix-run-mode');
const {getBuildInfo} = require('@wix/ci-build-info');

function isFalconCi() {
  if (isCI()) {
    try {
      return getBuildInfo().v2.isFalcon;
    } catch (e) {
      return false;
    }
  }
  return false;
}

const moduleDir = argv.module ? argv.module : process.cwd();
const skipProtoc = !!argv.skipProtoc;
const skipLint = !!argv.skipLint || isFalconCi();
const validatedModule = {
  location: moduleDir,
  skipPomValidation: isCI(),
  skipProtoc,
  skipLint,
};
protoModuleValidator(validatedModule)
  .then(() => {
    console.log('module passed proto module validation');
  }, err => {
    console.error(err);
    process.exit(1);
  });

