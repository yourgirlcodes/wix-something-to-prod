const Validator = require('fastest-validator');
const MESSAGES = require('./messages');

const extensions = [
  require('./binary'),
  require('./long'),
  require('./long-string'),
  require('./protobuf-any'),
  require('./map'),
  require('./uri'),
  require('./ipv4'),
  require('./ipv6'),
  require('./hostname'),
  require('./phone'),
  require('./color-hex'),
  require('./language-tag'),
  require('./country'),
  require('./currency'),
  require('./language'),
  require('./decimal'),
  require('./oneof'),
  require('./email'),
  require('./guid'),
  require('./number-ext'),
  require('./repeated'),
];

const messages = extensions.reduce((acc, {messages}) => Object.assign(acc, messages), MESSAGES);

const validator = extensions.reduce((validator, extension) => {
  if (extension.alias && extension.schema) {
    validator.alias(extension.alias, extension.schema);
  } else if (extension.rules) {
    Object.keys(extension.rules).forEach(rule => validator.add(rule, extension.rules[rule]));
  }
  return validator;
}, new Validator({useNewCustomCheckerFunction: true, messages}));

module.exports = {validator};
