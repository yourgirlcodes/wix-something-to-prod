const bcp47 = require('bcp-47');
const {languages} = require('country-data');
const currencies = require('./currency-codes')
const localeData  = require('@wix/locale-dataset-javascript');
const _ = require('lodash');

function toSet(collection) {
  return new Set(_(collection).omit('all').keys().map(key => key.toLowerCase()).value());
}

function countriesToSet(countries) {
  return new Set(countries.flatMap((value) => [value.key, value.shortKey]).map(key => key.toLowerCase()));
}

const CURRENCY_CODES = new Set(currencies.map(key => key.toLowerCase()));
const LANG_CODES = toSet(languages);
const COUNTRY_CODES = countriesToSet(localeData.getAllCountries());
function isValidLanguageTag(value) {
  const {language, region} = value && bcp47.parse(value) || {};
  return !!(language && LANG_CODES.has(language.toLowerCase()) && (region ? COUNTRY_CODES.has(region.toLowerCase()) : true));
}

module.exports = {CURRENCY_CODES, COUNTRY_CODES, LANG_CODES, isValidLanguageTag};
