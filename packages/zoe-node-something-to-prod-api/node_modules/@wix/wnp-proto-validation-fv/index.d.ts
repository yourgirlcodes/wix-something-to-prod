import {$$GeneratedMessage$$} from '@wix/wnp-proto-runtime-types';
import {AspectStore} from '@wix/wix-aspects';
import Validator, {ValidationSchema} from 'fastest-validator';

type Method<T, R> = (aspects: AspectStore, message: T) => Promise<R>;

type CheckFn = ReturnType<typeof Validator.prototype.compile>;

export interface ValidationOptions {
  readonly wixValidations: boolean;
}

export const validator: Validator;

type AttemptOptions = {
  error: { new(message: string): Error };
  prefix?: string;
};

export function attempt<T>(schema: ValidationSchema<T>, value: T, opts?: AttemptOptions): T;
export function attempt<T>(checkFn: CheckFn, value: T, opts?: AttemptOptions): T;

export class SchemaBuilder {
  constructor(opts: ValidationOptions);
  forMessageClass<T>(clazz: $$GeneratedMessage$$<T>): ValidationSchema;
  forMethod<T, R>(method: Method<T, R>): ValidationSchema;
}




