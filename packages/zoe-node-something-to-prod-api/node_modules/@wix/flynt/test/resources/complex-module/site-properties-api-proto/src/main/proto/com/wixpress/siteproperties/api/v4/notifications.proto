syntax = "proto3";

package com.wixpress.siteproperties.api.v4;

import "com/wixpress/siteproperties/api/v4/properties.proto";
import "google/protobuf/field_mask.proto";


// A single mapping from the MetaSite ID to a particular service.
message Translation {
    string service_type = 1; // The service type.
    string app_def_id = 2; // The application definition ID; this only applies to services of type ThirdPartyApps.
    string instance_id = 3; // The instance ID of the service.
}

enum NotificationContext {
    PROPERTIES_UPDATE = 0;
    SITE_CREATED = 1;
    SITE_CLONED = 2;
}

message ChangeContext {
    oneof payload {
        PropertiesChange properties_change = 1;
        SiteCreated site_created = 2;
        SiteCloned site_cloned = 3;
    }
}

message PropertiesChange {}

message SiteCreated {}

message SiteCloned {
    string origin_meta_site_id = 1;
}


// Encapsulates all details written to the Greyhound topic when a site's properties are updated.
message SitePropertiesNotification {
    string metasite_id = 1; // The site ID for which this update notification applies.
    SitePropertiesEvent event = 2; // The actual update event.
    repeated Translation translations = 3; // A convenience set of mappings from the MetaSite ID to its constituent services.
    ChangeContext change_context = 5; // Context of the notification
}

// The actual update event for a particular notification.
message SitePropertiesEvent {
    uint32 version = 1; // The version of the site's properties represented by this update.
    google.protobuf.FieldMask fields = 2; // The set of properties that were updated. This corresponds to the fields in "properties".
    Properties properties = 3; // The actual value of the updated property.
}

/*
  The set of service types that can be contained within a MetaSite. "Unknown" is a special type used when the service
  type cannot be resolved (this can happen when a new service type is added, but messages are handled by an
  older version of the consumer).
*/
enum EmbeddedServiceType {
    UNKNOWN = 0;
    CONTACTS = 1;
    LISTS_APP = 2;
    THIRD_PARTY_APPS = 3;
    SITE_MEMBERS = 4;
    ECOMMERCE = 5;
    APP_BUILDER = 6;
    PROVIDED_MAILING_SERVICE = 7;
    MOBILE_SERVICES = 8;
    CLOUD_SITE_EXTENSION = 9;
    MOBILE_APP = 10;
    ONBOARDING = 11;
    CLUBS = 12;
}
