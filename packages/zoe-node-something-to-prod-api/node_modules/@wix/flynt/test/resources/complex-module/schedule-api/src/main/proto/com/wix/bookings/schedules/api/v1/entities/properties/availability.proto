syntax = "proto3";

package com.wix.bookings.schedules.api.v1;
import "com/wix/bookings/common/api/v1/entities/location.proto";
import "com/wix/bookings/schedules/api/v1/entities/properties/linkedSchedule.proto";
import "com/wix/bookings/schedules/api/v1/entities/properties/availabilityPolicy.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "wix/api/annotations.proto";
import "wix/api/validations.proto";

//<!-- Needs updating when recurrence has been tested 
//Schedule's availability calculation is executed by the schedule's available intervals and this additional information.
//Schedule's available intervals are recurring intervals (defined in the schedule) minus sessions that has no more spots for bookings (including time between_slots), or schedule's sessions with open spots for bookings.-->
message Availability {
    //Date and time the schedule starts to be available for booking.
    google.protobuf.Timestamp start = 1;
    //Date and time the schedule stops being available for booking. No value indicates no end time.
    google.protobuf.Timestamp end = 2;
    //Other schedules that impact the availability calculation. Relevant only when there are availability constraints.
    repeated LinkedSchedule linked_schedules = 8;
    //Constraints for calculating the schedule's availability.
    AvailabilityConstraints constraints = 3;
    // Not supported yet.
    //A list of possible locations for the session when `use_default_location` is set to `false`. Slots are generated for each location. Only one of the possible locations can be chosen by the customer. 
    //
    // **NOTE**: When using the `locations` parameter, the default location is not automatically included in the list.
    repeated com.wix.bookings.common.api.v1.Location locations = 4 [(.wix.api.field_exposure) = INTERNAL];

    // Not supported yet.
    // Whether the schedule's slots are only available at the schedule's default location, as set in `schedule.location`. If set to `false`, the `locations` array is used to set the possible locations of the schedule's sessions.
    // Default is `true`.    
    google.protobuf.BoolValue use_default_location = 5 [(.wix.api.field_exposure) = INTERNAL];
}

//Describes how to calculate the specific slots that are available for booking.
message AvailabilityConstraints {
    //A list of duration options for slots, in minutes. Minimum value for a duration is 1.
    //The availability calculation generates slots with these durations, where there is no conflict with existing sessions or other availability constraints.
    repeated int32 slot_durations = 3 [(.wix.api.min) = 1];
    //The number of minutes between the `end` of one slot, and the `start` of the next. 
    //Minimum value is 0, maximum value is 120.
    int32 time_between_slots = 4 [(.wix.api.min) = 0, (.wix.api.max) = 120];
    //Specify how to split the slots in intervals of minutes.
    //This value indicates the time between available slots' start time. e.g., from 5 minute slots (3:00, 3:05, 3:15) and 1 hour slots (3:00, 4:00, 5:00).
    //Optional. The default is the first duration in slot_durations field.
    //Deprecated. Use the `split_slots_interval.value_in_minutes`.
    google.protobuf.Int32Value split_interval = 5 [deprecated = true];
    //An object defining the time between available slots' start times.  For example, a slot with slots_split_interval=5 can start every 5 minutes. The default is the slot duration.
    SplitInterval slots_split_interval = 6 [(.wix.api.readOnly) = true];
}
