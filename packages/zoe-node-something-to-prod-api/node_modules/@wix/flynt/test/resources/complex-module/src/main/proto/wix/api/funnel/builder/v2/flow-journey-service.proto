syntax = "proto3";

package wix.api.funnel.builder.v2;

import "wix/api/validations.proto";
import "wix/api/annotations.proto";
import "google/api/annotations.proto";
import "wix/api/funnel/builder/v2/flow.proto";

service FlowJourneyService {

    // This method should be called at the beginning of the flow. It creates an empty
    // flow context or restores it from url path which has encoded answers in it
    // in case user opened the flow somewhere in the middle
    rpc InitFlowContext (InitFlowContextRequest) returns (InitFlowContextResponse) {
        option (google.api.http).get = "/v2/flow/context";
        option (wix.api.exposure) = INTERNAL;
        option (wix.api.maturity) = ALPHA;
        option (wix.api.required) = "InitFlowContextRequest.initial_location";
    }

    rpc GetNextTransition (GetNextTransitionRequest) returns (GetNextTransitionResponse) {
        // note: POST method is used here to simplify complex request data serialization/deserialization
        option (google.api.http).post = "/v2/flow/transitions/next";
        option (wix.api.exposure) = INTERNAL;
        option (wix.api.maturity) = ALPHA;
        option (wix.api.required) = "GetNextTransitionRequest.flow_context";
    }

}

message InitFlowContextRequest {
    string initial_location = 1;
}

message InitFlowContextResponse {
    FlowContext flow_context = 1;
}

message GetNextTransitionRequest {
    FlowContext flow_context = 1;
}

message GetNextTransitionResponse {
    Transition transition = 1;
}
