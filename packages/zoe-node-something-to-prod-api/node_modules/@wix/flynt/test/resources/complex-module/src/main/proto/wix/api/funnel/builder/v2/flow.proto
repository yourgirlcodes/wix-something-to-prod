syntax = "proto3";

package wix.api.funnel.builder.v2;

import "wix/api/validations.proto";
import "google/protobuf/wrappers.proto";

message FlowContext {
    repeated HistoryEntry history_entries = 1 [(wix.api.minSize) = 1];

    map<string, Answer> answers = 2 [(wix.api.maxSize) = 50];

    map<string, string> experiments = 3 [(wix.api.maxSize) = 50];

    map<string, string> metadata = 4 [(wix.api.maxSize) = 50];
}

message HistoryEntry {
    string flow_id = 1 [(wix.api.format) = GUID];

    google.protobuf.StringValue page_id = 2 [(wix.api.format) = GUID];

    google.protobuf.StringValue snapshot_id = 3 [(wix.api.format) = GUID];
}

message Answer {
    bool skipped = 1;

    // answer keys of the ChoiceQuestion or plain text in case of FreeText question
    repeated string values = 2;
}

message Transition {
    message InternalTarget {
        string target_flow_id = 1;

        string target_page_id = 2;

        google.protobuf.StringValue target_snapshot_id = 3;
    }

    message ExternalTarget {
        string target_url = 1;
    }

    oneof target {
        InternalTarget internal = 2;

        ExternalTarget external = 3;
    }
}
