import type * as Sentry from '@sentry/node';

let sentry: typeof Sentry;

export async function reportError(error: unknown, {extra, tags}: {extra?: Record<string, unknown>; tags?: Record<string, string | undefined>} = {}) {
  try {
    if (!sentry) {
      sentry = await import('@sentry/node');
    }
    sentry.init({
      dsn: process.env.FLYNT_TEST_MODE ? '' : 'https://25208199213d44e2ae351417e1e95b04@o37417.ingest.sentry.io/6235775',
      ignoreErrors: ['protoc execution failed'],
    });

    sentry.captureException(error, {extra, tags});
    await sentry.flush();
  } catch (err) {
    console.log(`Failed to report to sentry: ${err}. Error that was reported: ${error}`);
  }
}


