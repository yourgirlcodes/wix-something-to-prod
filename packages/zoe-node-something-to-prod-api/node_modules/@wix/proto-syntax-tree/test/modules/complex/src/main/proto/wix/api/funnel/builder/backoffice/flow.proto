syntax = "proto3";

package wix.api.funnel.builder.backoffice;

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";

import "wix/api/validations.proto";

import "wix/api/funnel/builder/backoffice/monitoring.proto";

message Flow {
    string id = 1 [(wix.api.readOnly) = true, (wix.api.format) = GUID];

    // Current version of the flow. Used for optimistic locking.
    // Operations which mutate the flow will require the current expected version as a parameter and fail if it doesn't match.
    // Read-Only, cannot be changed by the API.
    int32 version = 2 [(wix.api.readOnly) = true];

    string name = 3 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];

    string mount_point = 4 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];

    repeated Transition transitions = 5;

    google.protobuf.Timestamp created_at = 6;

    google.protobuf.Timestamp updated_at = 7;

    google.protobuf.Timestamp deleted_at = 8;

    MonitoringDashboardDetails monitoring_dashboard_details = 9;
}

message Transition {
    message InternalTarget {
        string target_flow_id = 1 [(wix.api.format) = GUID];

        string target_page_id = 2 [(wix.api.format) = GUID];
    }

    message ExternalTarget {
        string target_url = 1 [(wix.api.minLength) = 1, (wix.api.maxLength) = 255];
    }

    google.protobuf.StringValue origin_page_id = 1 [(wix.api.format) = GUID];

    oneof target {
        InternalTarget internal = 2;

        ExternalTarget external = 3;
    }

    repeated Condition conditions = 4 [(wix.api.maxSize) = 100];
}

message Condition {
    message AnswerCondition {
        string question_key = 1 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];

        string value = 2 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];
    }

    message ExperimentCondition {
        string spec = 1 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];

        string value = 2 [(wix.api.minLength) = 1, (wix.api.maxLength) = 20];
    }

    message MetadataParamCondition {
        string name = 1 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];

        string value = 2 [(wix.api.minLength) = 1, (wix.api.maxLength) = 100];
    }

    oneof condition {
        AnswerCondition answer = 1;

        ExperimentCondition experiment = 2;

        MetadataParamCondition metadata = 3;
    }
}
