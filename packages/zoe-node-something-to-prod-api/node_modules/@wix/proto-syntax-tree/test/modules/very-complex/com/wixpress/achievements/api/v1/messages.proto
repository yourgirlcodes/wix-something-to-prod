syntax = "proto3";

package com.wixpress.achievements.api.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

message Participant {
    string id = 1;
    StepsSummary steps_summary = 5;
    repeated StateTransition transitions = 7;

    enum State {
        JOIN_REQUESTED = 0;
        INVITED = 1;
        JOIN_REJECTED = 2;
        PAYMENT_REQUESTED = 3;
        PAYMENT_STARTED = 4;
        JOINED = 5;
        LEFT = 6;
        REMOVED = 7;
        RUNNING = 8;
        COMPLETED = 9;
        FAILED = 10;
    }

    message StepsSummary {
        int32 steps_number = 1;
        int32 completed_steps_number = 2;
        int32 failed_steps_number = 3;
        int32 posted_feedbacks_number = 4;
        StepEvent last_event = 5;
    }

    message StepEvent {
        string step_id = 1;
    }

    message StateTransition {
        State state = 1;
        google.protobuf.Timestamp occurred_at = 2;
    }
}

message Challenge {
    string id = 1;
    Settings settings = 3;
    StepsSummary steps_summary = 4;
    ParticipantsSummary participants_summary = 5;
    repeated StateTransition transitions = 6;

    enum State {
        DRAFT = 0;
        PUBLISHED = 1;
        FINISHED = 2;
        ARCHIVED = 3;
    }

    message StepsSummary {
        int32 steps_number = 1;
    }

    message ParticipantsSummary {
        int32 participants_number = 1;
        int32 join_requests_number = 2;
        int32 invitations_number = 3;
    }

    message StateTransition {
        State state = 1;
        google.protobuf.Timestamp occurred_at = 2;
    }

    message Settings {
        TimelineType timeline_type = 2;
        AccessRestrictions access_restrictions = 3;
        Pricing pricing = 5;
    }

    message TimelineType {
        oneof type {
            Ongoing ongoing = 1;
            Flexible flexible = 2;
            Specific specific = 3;
        }

        message Ongoing {
            string single_time_zone = 2;
        }

        message Flexible {
        }

        message Specific {
            string single_time_zone = 3;
        }
    }

    message AccessRestrictions {
        google.protobuf.Int32Value max_participants = 2;
    }

    message Pricing {
        SinglePayment single_payment = 1;
        repeated PaidPlan paid_plans = 2;

        message SinglePayment {
            repeated PaymentMethod allowed_methods = 2;

            enum PaymentMethod {
                ONLINE_PAYMENT = 0;
                OFFLINE_PAYMENT = 1;
            }
        }

        message PaidPlan {
            string id = 1;
        }
    }
}
