# Proto Syntax Tree

A library that parses proto files and creates an AST (Abstract Syntax Tree) from it

## install

```
npm install --save-dev @wix/proto-syntax-tree
```

## API

```typescript
import {generateSyntaxTree, SyntaxTree} from '@wix/proto-syntax-tree';

const st: SyntaxTree = await generateSyntaxTree('./src/proto', {
  include: ['./include/other-api/proto'] ,
  includeStdProtos: true,
});
```

### `generateSyntaxTree(mainProtoFolder: string, opts: GenSyntaxTreeOptions): Promise<SyntaxTree>` 
Parses and generates an AST from the proto files located in `mainProtoFolder` optionally taking into account 
additional files from include folders and standard protos

- `mainProtoFolder`: location where proto files reside in. `generateSyntaxTree` scans this directory for `*.proto` and generates an AST from all the files within that folder
- `opts.include`: additional folders to search for proto files imported by the file in mainProtoFolder 
- `opts.includeStdProtos`: include standard google and wix proto files (for example `google/protobuf/wrappers.proto` and `wix/api/validations.proto`) 

returns a [`SyntaxTree`](#syntax-tree)

### `visitSyntaxTree(st: SyntaxTree, visitor: Visitor)`
Visits the syntaxt tree using the provided [visitor](#visitor)

### Syntax Tree

```typescript
export interface SyntaxTree {
  files: ProtoFile[];

  findType(fqn: string): Type | undefined;
  getType(fqn: string): Type;
  getFile(fqn: string): ProtoFile;
  getService(fqn: string): Service;
  getMethod(fqn: string): Method;
  getMessage(fqn: string): Message;
  getExtension(fqn: string): Extension;
  getEnum(fqn: string): Enum;
  getField(fqn: string): Field;
  getOneof(fqn: string): Oneof;
  getEnumValue(fqn: string): EnumValue;
}
```

Notes:
- the `getType` find a Type by its fully qualified name (fqn) and returns it or throw an error if the type was not found.
- `findType` is equivalent to `getType` but returns `undefined` if the type was not found 
- the `get*` methods find a Type and also makes sure it is of the correct type. i.e. calling `getService()` with a `fqn` of a `Message` will throw an error


### Visitor
An object used to iterate over elements of a syntax tree. Implement this interface in order to use the built in
traversal mechanism implemented by the `visit` function. 
All methods are optional so if in order, for example, to visit just proto Messages and Enums, you can implement
only `visitMessage` and `visitEnum`. 
Returning `false` from a method stops traversing any nested elements. For example, returning `false` from `visitFile` means
none of the `Messages`, `Enums`, `Services` etc inside that file will be traversed.

```typescript
export interface Visitor {
  visitFile?(file: ProtoFile): boolean | void;
  visitService?(service: Service): boolean | void;
  visitMessage?(message: Message): boolean | void;
  visitEnum?(enm: Enum): boolean | void;
  visitMethod?(method: Method): void;
  visitField?(field: Field): void;
  visitOneof?(oneof: Oneof): void;
  visitEnumValue?(enumValue: EnumValue): void;
  visitExtension?(extension: Extension): void;
}
```
