syntax = "proto2";

package wix.api;

import "google/protobuf/descriptor.proto";
import "wix/api/callback.proto";

option java_multiple_files = true;
option java_outer_classname = "SubscriptionProto";
option java_package = "com.wix.api";

/*
Marks a method as a topic consumer.
service BlooperService {
   rpc Update (BlooperUpdateNotification) returns (google.protobuf.Empty) {
       option (wix.api.subscription) = {
           topic: "Blooper.Update"
       };
   };
}
*/
extend google.protobuf.MethodOptions {
    optional Subscription subscription = 50400;
}

message Subscription {
    optional string topic = 1;
    optional Segment.Segment segment = 4; // currently defaults to "legacy", will be `required` when legacy cluster is removed
    optional bool batch = 2;
    optional string entity = 3;
    optional MessageConsumeMode consume_mode = 5;
}

enum MessageConsumeMode {
    SINGLE_MESSAGE = 0;
    BATCH_MESSAGES = 1;
    LEGACY_BATCH_MESSAGES = 2;
}
