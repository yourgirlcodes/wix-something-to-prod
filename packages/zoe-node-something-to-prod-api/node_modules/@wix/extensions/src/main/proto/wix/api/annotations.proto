syntax = "proto2";

package wix.api;

import "google/protobuf/descriptor.proto";

option java_multiple_files = true;
option java_outer_classname = "AnnotationsProto";
option java_package = "com.wix.api";

extend google.protobuf.ServiceOptions {
    optional Maturity service_maturity = 50104;
    optional Exposure service_exposure = 50105;
    optional Deprecated service_deprecated = 50140; // mark a service as deprecated, optionally place replacing asset
    repeated ServiceAppendix appendix_files = 50150; // declare external configuration info
}

extend google.protobuf.MethodOptions {
    optional Exposure exposure = 50101;
    optional Maturity maturity = 50102;
    optional CacheSettings cacheable = 50103; // mark a method as cacheable, optionally pass max cache age
    optional Deprecated deprecated = 50141; // mark a method as deprecated, optionally place replacing asset
    optional Crud crud = 50146; // mark crud method type and describe related information about this method
    optional Hookable hookable = 50147;
    optional bool accepts_linguist = 50148; // marks that this method accepts `x-wix-linguist` header, MAY return translated/localized responses. without this option, requests that assign this header will get an error. CRUD annotated methods assumed to have this enabled for read ops and disabled for write ops.
}

extend google.protobuf.MessageOptions {
    optional string decomposite_of = 50120; // mark it a shard of a message to remove fields
    repeated FieldSet decomposition_minimum_fields = 50121; // constrain that sharding at the definition
    optional bool unwrap_array_value = 50122; // mark message as wrapper for arrays
    optional Deprecated message_deprecated = 50142; // mark a message as deprecated, optionally place replacing asset
    repeated Unique unique = 50145; // mark unique identifiers for this message
}

extend google.protobuf.FieldOptions {
    optional Exposure field_exposure = 50106;
    optional Maturity field_maturity = 50107;
    optional bool pii = 50110; // Mark specific field as PII so clients that store the data know it should be encrypted
    optional string referenced_entity = 50111; // FQDN of foreign keys. For example, an Order message that points to Product message can use it like this: `string product_id = 10 [(wix.api.referenced_entity) = "wix.stores.catalog.product"];`
    optional Deprecated field_deprecated = 50143; // Mark a field as deprecated, optionally place replacing asset
    optional Translatable translatable = 50144; // Mark this field as translatable using MultiLingual services
}

extend google.protobuf.EnumValueOptions {
    optional Maturity enum_maturity = 50130;
    optional Exposure enum_exposure = 50131;
}

message CacheSettings {
    optional int32 max_age_seconds = 1; // default is 604800 seconds = 1 week
}

message FieldSet {
    repeated string field = 1;
}

message Deprecated {
    optional string replaced_by = 1; // use relative proto FQN as absolute identifier. e.g. "wix.common.Query"
    optional string target_removal_date = 2; // a human readable sunset date of the deprecated resource YYYY-MM-DD
}

message Unique {
    repeated string field = 1;
}

message Crud {
    enum Method {
        UNKNOWN_METHOD = 0;
        CREATE = 1;
        GET_ITEM = 2;
        UPDATE = 3;
        DELETE = 4;
        UPSERT = 12;
        LIST = 5;
        QUERY = 6;
        SEARCH = 18;
        BULK_CREATE = 7;
        BULK_UPDATE = 8;
        BULK_UPDATE_BY_FILTER = 9;
        BULK_DELETE = 10;
        BULK_DELETE_BY_FILTER = 11;
        BULK_UPSERT = 13;
        LIST_DELETED = 14;
        GET_DELETED = 15;
        RESTORE_FROM_TRASHBIN = 16;
        REMOVE_FROM_TRASHBIN = 17;
    }
    required Method method = 1; // method type
    oneof method_options {
        CreateMethodOptions create_options = 3;
        GetItemMethodOptions get_options = 4;
        UpdateMethodOptions update_options = 5;
        DeleteMethodOptions delete_options = 6;
        ListMethodOptions list_options = 7;
        QueryMethodOptions query_options = 8;
        SearchMethodOptions search_options = 20;
        BulkCreateMethodOptions bulk_create_options = 9;
        BulkUpdateMethodOptions bulk_update_options = 10;
        BulkUpdateByFilterMethodOptions bulk_update_by_filter_options = 11;
        BulkDeleteMethodOptions bulk_delete_options = 12;
        BulkDeleteByFilterMethodOptions bulk_delete_by_filter_options = 13;
        UpsertMethodOptions upsert_options = 14;
        BulkUpsertMethodOptions bulk_upsert_options = 15;
        ListDeletedMethodOptions list_deleted_options = 16;
        GetDeletedMethodOptions get_deleted_options = 17;
        RestoreFromTrashbinMethodOptions restore_from_trashbin_options = 18;
        RemoveFromTrashbinMethodOptions remove_from_trashbin_options = 19;
    }
}

message Paging {
    enum Type {
        UNKNOWN_TYPE = 0;
        OFFSET = 1;
        CURSOR = 2;
    }
    optional Type type = 1; // paging type
    optional string paging_metadata_field = 2; // paging field name in response object. default is `metadata`
}

message CreateMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message GetItemMethodOptions {
    optional string item_field = 2; // item field name in response object only. default is `<entity-name>`
    optional string id_field = 1; // id field name in request object. default is `<entity-name>_id`
}

message UpdateMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message UpsertMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message DeleteMethodOptions {
    optional string id_field = 1; // id field name in request object. default is `<entity-name>_id`
}

message ListMethodOptions {
    optional string ids_field = 1; // ids field name in request object. default is `<entity-name>_ids`
    required string items_field = 3; // items field name in response object.
    optional Paging paging = 2; // present paging mechanism info, default will be of type=`CURSOR`
}

message QueryMethodOptions {
    optional string query_field = 1; // query field name in request object. default is `query`
    required string items_field = 3; // items field name in response object.
    optional Paging paging = 2; // present paging mechanism info, default will be of type=`CURSOR`
    required Wql wql = 4; // mark fields that are available for filtering and sorting via WixQueryLanguage
}

message SearchMethodOptions {
    optional string search_field = 1; // search field name in request object. default is `search`
    required string items_field = 3; // items field name in response object.
    optional Paging paging = 2; // present paging mechanism info, default will be of type=`CURSOR`
    required Wql wql = 4; // mark fields that are available for filtering and sorting via WixQueryLanguage
}

message BulkCreateMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message BulkUpdateMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message BulkUpdateByFilterMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
    optional string filter_field = 3; // filter field name in request object. default is `filter`
}

message BulkUpsertMethodOptions {
    optional string item_field = 1; // item field name in request and response objects. default is `<entity-name>`
    optional string fieldmask_field = 2; // fieldmask field name in request object. default is `fieldmask`, only if it really exists in model
}

message BulkDeleteMethodOptions {
    optional string ids_field = 1; // ids field name in request object. default is `<entity-name>_ids`
}

message BulkDeleteByFilterMethodOptions {
    optional string filter_field = 1; // filter field name in request object. default is `filter`
}

message ListDeletedMethodOptions {
    optional string ids_field = 1; // ids field name in request object. default is `<entity-name>_ids`
    required string items_field = 3; // items field name in response object.
    optional Paging paging = 2; // present paging mechanism info, default will be of type=`CURSOR`
}

message GetDeletedMethodOptions {
    optional string item_field = 2; // item field name in response object only. default is `<entity-name>`
    optional string id_field = 1; // id field name in request object. default is `<entity-name>_id`
}

message RestoreFromTrashbinMethodOptions {
    optional string item_field = 2; // item field name in response object only. default is `<entity-name>`
    optional string id_field = 1; // id field name in request object. default is `<entity-name>_id`
}

message RemoveFromTrashbinMethodOptions {
    optional string id_field = 1; // id field name in request object. default is `<entity-name>_id`
}

message Wql {
    enum Operator {
        ALL_APPLICABLE_OPERATORS = 0; // Applicable by type. i.e. if we allow LT/GT for **, it means for numeric fields only.
        EQ = 1; // [Comparison] Matches values that are equal to a specified value.
        GT = 2; // [Comparison] Matches values that are greater than a specified value.
        GTE = 3; // [Comparison] Matches values that are greater than or equal to a specified value.
        IN = 4; // [Comparison] Matches any of the values specified in an array.
        LT = 5; // [Comparison] Matches values that are less than a specified value.
        LTE = 6; // [Comparison] Matches values that are less than or equal to a specified value.
        NE = 7; // [Comparison] Matches all values that are not equal to a specified value.
        NIN = 8; // [Comparison] Matches none of the values specified in an array.
        BEGINS = 9; // [Comparison] Matches strings that begin with a specified value (NOT case sensitive).
        EXISTS = 10; // [Element] Matches documents that have the specified field.
        ALL = 11; // [Array] Matches arrays that contain all elements specified in the query.
        ANY = 12; // [Array] Matches arrays that contain at least one element specified in the query.
        EMPTY = 13; // [Array] Matches arrays that contain no elements.
    }
    enum Sort {
        NONE = 0; // sort not supported
        ASC = 1; // ascending sort is supported
        DESC = 2; // descending sort is supported
        BOTH = 3; // sort is supported in both directions
    }
    message RequiredFields {
        repeated string field = 1; // all required fields to satisfy composite index
    }
    message OperatorFieldSupport {
        repeated Operator operator = 1; // Operators supported for fields that match the glob
        required string glob = 2; // a comma separated [glob](https://en.wikipedia.org/wiki/Glob_(programming)) formatted string to match field paths that that accepts this operator. Supports: `*`, `**`, `!`. will be matched in order. Fields that meet all requirements of the glob will get the operator and sort of this `operator_field_support`
        optional Sort sort = 3; // sort type enabled for this glob
        repeated RequiredFields required_fields = 4; // fields that match this glob, can be used only if the query is also filtered by required_fields
    }
    repeated OperatorFieldSupport operator_field_support = 3; // supported operators for subject query method
}

message Hookable {
}

message Translatable {
    enum Type {
        UNDEFINED_TYPE = 0 [(.wix.api.enum_maturity) = NOT_IMPLEMENTED];
        SHORT_TEXT = 1;
        LONG_TEXT = 2;
        RICH_TEXT = 3;
        RICH_CONTENT_EDITOR = 4;
        SELECTION = 5;
        MULTI_SELECTION = 6;
        DOCUMENT = 7;
        IMAGE = 8;
        VIDEO = 9;
    }
    optional string name = 1; // a human friendly field name
    optional bool hidden = 2; // is this translatable field hidden in Multilingual
    required string grouping = 3; // fields in schema may be grouped under meaningful topic or category of the source entity
    required Type type = 4; // translation input component type e.g. "freetext", "dropdown", etc..
}

message ServiceAppendix {
    enum Type {
        UNKNOWN_APPENDIX_TYPE = 0;
        NILE = 1; // Nile(tm) FW configuration
        MESSAGE_BUS = 2; // wix message bus / pub-sub configuration
    }
    required Type type = 1; // appendix type
    required string path = 2; // absolute from module root
}

enum Exposure {
    PRIVATE = 0;
    INTERNAL = 1;
    PUBLIC = 2;
}

enum Maturity {
    ALPHA = 0;
    BETA = 1;
    IA = 2 [deprecated=true];
    GA = 3;
    NOT_IMPLEMENTED = 4;
}
