import {SourceCodeInfo} from '@wix/proto-syntax-tree';

function getRulesInComment(comment: string) {
  return comment
    .split(/\n/)
    .map(line => line.trim())
    .map(line => line.match(/^flynt-disable\s+(.*)/))
    .map(item => item?.[1].trim().split(/\s*,\s*/))
    .flat()
    .filter(rule => !!rule) as string[];
}
export function isRuleDisabledInComment(comment: string, ruleName: string): boolean {
  if (comment) {
    const rules = getRulesInComment(comment);
    return rules.includes(ruleName);
  }
  return false;
}

export function isRuleDisabled(scInfo: SourceCodeInfo, ruleName: string): boolean {
  return isRuleDisabledInComment(scInfo.leadingComments, ruleName)
    || isRuleDisabledInComment(scInfo.trailingComments, ruleName)
    || !!scInfo.leadingDetachedComments.find(comment => isRuleDisabledInComment(comment, ruleName));
}

