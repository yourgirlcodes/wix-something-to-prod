import {LintRule} from '../../../../..';

export const rule: LintRule = {
  description: 'only one service allowed per proto file',
  moreInfoUrl: 'http://www.single-service.com',
  async run(ctx) {
    const servicesPerFile = new Set<string>();

    ctx.visit({
      visitService(service) {
        if (servicesPerFile.has(service.file.name)) {
          ctx.report({errorAt: service});
        } else {
          servicesPerFile.add(service.file.name);
        }
      }
    });
  }
};
